<link rel="stylesheet" href="assets/css/datepicker.css" />
<link rel="stylesheet" href="assets/css/bootstrap-timepicker.css" />
<link rel="stylesheet" href="assets/css/daterangepicker.css" />
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="assets/js/date-time/bootstrap-timepicker.min.js"></script>
<script src="assets/js/date-time/moment.min.js"></script>
<script src="assets/js/date-time/daterangepicker.min.js"></script>

<style type="text/css">
    body > .container-fluid {
        padding: 0;
    }
</style>
<div class="mc-uamp">
    <div class="sidebar">
        <h3>
            <i class=" icon-bar-chart"></i>
            UA 指标
        </h3>
        <ul class="nav nav-list">
            <li ng-repeat="report in reportList">
                <a ng-href="">{{report.name}}</a>
            </li>
        </ul>
    </div>
    <div class="main-content">
        <div class="op-bar">
            <div class="multi-fn-datepicker">
                <!-- export: state.period -->
                <div data-toggle="buttons-radio" class="btn-group fn-chooser">
                    <button class="btn btn-primary" type="button"
                        ng-class="{'active': state.period==i}"
                        ng-click="state.period=i;"
                        ng-repeat="i in ['day', 'week', 'month']">
                        {{i}}
                    </button>
                </div>

                <!-- config: [state.period] -->
                <div class="input-append datepicker">
                    <input class="date-picker" id="id-date-picker-1" type="text" data-date-format="dd-mm-yyyy" />
                    <span class="add-on">
                        <i class="icon-calendar"></i>
                    </span>
                </div>

                <script type="text/javascript">
                    var baseOpt = {
                        autoclose: true,
                        todayHighlight: true,
                        endDate: new Date()
                    };

                    // day
                    /*$('.date-picker').datepicker(_.extend(baseOpt, {
                        format: 'yyyy-mm-dd'
                    }));

                    // week
                    $('.date-picker').datepicker(_.extend(baseOpt, {
                        format: 'yyyy-mm-dd',
                        daysOfWeekDisabled: "0,2,3,4,5,6"
                    }));*/

                    // month
                    $('.date-picker').datepicker(_.extend(baseOpt, {
                        format: 'yyyy-mm',
                        minViewMode: 'months',
                        startView: 'months'
                    }));
                </script>
            </div>

            <!-- label+input-select2-multi -->
            <script type="text/ng-template" id="uamp-checkbox-select.html">
                <label class="uamp-checkbox-slect">
                    <span>{{i.disp_name}}</span>
                    <select multiple="multiple">
                        <option value="all">全部</option>
                        <option ng-repeat="(k,v) in i.dimension_value" ng-value="k">
                            {{v}}
                        </option>
                    </select>
                </label>
            </script>
            <!-- config: [report] -->
            <div uamp-checkbox-select ng-repeat="i in state.report.dimension"></div>

            <button class="btn apply-btn">Apply</button>
        </div>

        <!-- todo 支持child字段的级联渲染
            config: [report, state.period, state.start|end|Date, state.dimensions] -->
        <!-- collapsable-data-table -->
        <table class="table">
            <tr>
                <td ng-show="state.isSelectMetricMode">选择</td>

                <td ng-repeat="th in reportData.tableTitle">
                    {{th.disp_name}}
                </td>
            </tr>
            <tr ng-repeat="metric in flatMetricsData"
                ng-show="inferFromParent(metric)">
                <td ng-show="state.isSelectMetricMode"><input type="checkbox"></td>

                <td ng-show="inferFromParent(metric)" ng-style="setMetricLevelStyle(metric)">
                    <i class="icon-plus"
                        ng-click="toggleMetricOpenStatus(metric)"
                        ng-show="metric.haschild"
                        ng-class='{"icon-plus": !metric.isopened,
                                    "icon-minus": metric.isopened}'>
                    </i>
                    {{metric.name}}
                </td>

                <td ng-repeat="val in metric.data track by $index"
                    ng-bind-html="formatByType(val, $index)"></td>
            </tr>
        </table>

        <button type="button" class="btn" btn-checkbox
            ng-model="state.isSelectMetricMode">{{state.isSelectMetricMode?'取消':'看趋势'}}</button>
        <button type="button" class="btn"
            ng-show="state.isSelectMetricMode" ng-click="renderChart()">绘制</button>
        <!-- 监控 selectMetrics 的值，toggle 重现绘制 -->
        <button class="btn">导出 CSV</button>

        <!-- chart config: [state.metric-list] -->
        <div class="chart" ng-show="state.isShowChart">
            <label for="date-range-picker-wrapper">
                时间范围 -
                <div class="row-fluid input-prepend">
                    <span class="add-on">
                        <i class="icon-calendar"></i>
                    </span>
                    <input class="span10" type="text" name="date-range-picker" id="date-range-picker" />
                </div>
            </label>
            <highchart config="chartConfig"></highchart>
        </div>

        <script type="text/javascript">
            $('#date-range-picker').daterangepicker({
                ranges: {
                    'Today': [moment(), moment()],
                     'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
                     'Last 7 Days': [moment().subtract('days', 6), moment()],
                     'Last 30 Days': [moment().subtract('days', 29), moment()],
                     'This Month': [moment().startOf('month'), moment().endOf('month')],
                     'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
                },
                format: 'YYYY-MM-DD',
                endDate: moment()
            });
        </script>
    </div>
</div>